{% extends "base.html" %}

{% block content %}
<div class="booking-container">
    {% if step == 1 %}
    <!-- Step 1: Time Selection -->
    <div class="booking-step">
        <h2>Steg 1: Välj tid</h2>
        <div class="concert-date-info">
            <h3>Konsertdatum: {{ concert_date }}</h3>
        </div>
        <form method="POST" action="{{ url_for('public.booking_tickets') }}">
            <div class="time-selection">
                {% for show in shows %}
                <div class="time-option">
                    <input type="radio" id="show_{{ show.id }}" name="show_id" value="{{ show.id }}" required>
                    <label for="show_{{ show.id }}" class="time-label">
                        <div class="time-slot">
                            <span class="time">{{ show.start_time }}-{{ show.end_time }}</span>
                            <span class="availability">
                                {% if show.is_sold_out %}
                                    <span class="sold-out">Slutsåld</span>
                                {% else %}
                                    <span class="available">{{ show.available_tickets }} biljetter kvar</span>
                                {% endif %}
                            </span>
                        </div>
                    </label>
                </div>
                {% endfor %}
            </div>
            <div class="step-actions">
                <button type="submit" class="btn btn-primary">Nästa</button>
            </div>
        </form>
    </div>

    {% elif step == 2 %}
    <!-- Step 2: Ticket Selection -->
    <div class="booking-step">
        <h2>Steg 2: Välj antal biljetter</h2>
        <div class="selected-time">
            <p><strong>Konsertdatum:</strong> {{ concert_date }}</p>
            <p><strong>Vald tid:</strong> {{ show.start_time }}-{{ show.end_time }}</p>
        </div>
        
        <form method="POST" action="{{ url_for('public.booking_contact') }}">
            <input type="hidden" name="show_id" value="{{ show.id }}">
            
            <div class="ticket-selection">
                <div class="ticket-type">
                    <h3>Ordinarie biljett (200 kr)</h3>
                    <div class="ticket-counter">
                        <button type="button" class="btn-counter minus" data-type="adult">-</button>
                        <input type="number" name="adult_tickets" id="adult_tickets" value="0" min="0" max="4" readonly>
                        <button type="button" class="btn-counter plus" data-type="adult">+</button>
                    </div>
                </div>
                
                <div class="ticket-type">
                    <h3>Studentbiljett (100 kr)</h3>
                    <div class="ticket-counter">
                        <button type="button" class="btn-counter minus" data-type="student">-</button>
                        <input type="number" name="student_tickets" id="student_tickets" value="0" min="0" max="4" readonly>
                        <button type="button" class="btn-counter plus" data-type="student">+</button>
                    </div>
                </div>
            </div>
            
            <div class="total-section">
                <div class="total-display">
                    <p><strong>Totalt att betala:</strong> <span id="total-amount">0</span> kr</p>
                </div>
                <div class="swish-reminder">
                    <p>Glöm inte att swisha till <strong>{{ swish_recipient_name }}</strong></p>
                </div>
            </div>
            
            <div class="step-actions">
                <a href="{{ url_for('public.booking') }}" class="btn btn-secondary">Tillbaka</a>
                <button type="submit" class="btn btn-primary" id="next-btn" disabled>Till Betalning</button>
            </div>
        </form>
    </div>

    {% elif step == 3 %}
    <!-- Step 3: Contact Information -->
    <div class="booking-step">
        <h2>Steg 3: Kontaktuppgifter</h2>
        
        <div class="booking-summary">
            <h3>Din bokning:</h3>
            <ul>
                <li><strong>Konsertdatum:</strong> {{ concert_date }}</li>
                <li><strong>Ordinarie biljetter:</strong> {{ adult_tickets }} st</li>
                <li><strong>Studentbiljetter:</strong> {{ student_tickets }} st</li>
                <li><strong>Totalt:</strong> {{ total_amount }} kr</li>
            </ul>
        </div>
        
        <form method="POST" action="{{ url_for('public.booking_confirm') }}">
            <div class="contact-form">
                <div class="form-group">
                    <label for="first_name">Förnamn *</label>
                    <input type="text" id="first_name" name="first_name" required>
                </div>
                
                <div class="form-group">
                    <label for="last_name">Efternamn *</label>
                    <input type="text" id="last_name" name="last_name" required>
                </div>
                
                <div class="form-group">
                    <label for="email">E-postadress *</label>
                    <input type="email" id="email" name="email" required>
                </div>
                
                <div class="form-group">
                    <label for="phone">Telefonnummer *</label>
                    <input type="tel" id="phone" name="phone" required>
                </div>
                
                <div class="form-group checkbox-group">
                    <input type="checkbox" id="gdpr_consent" name="gdpr_consent" required>
                    <label for="gdpr_consent">Jag godkänner att denna information sparas för verifiering och raderas senast 1 månad efter konserten hos Klasskonsertgruppen *</label>
                </div>
            </div>
            
            <div class="swish-reminder">
                <p><strong>OBS!</strong> Du har reserverat en plats först när du BÅDE har reserverat en biljett här på hemsidan - och du har swishat summan till <strong>{{ swish_recipient_name }}</strong>.</p>
            </div>
            
            <div class="step-actions">
                <a href="{{ url_for('public.booking_tickets') }}" class="btn btn-secondary">Tillbaka</a>
                <button type="submit" class="btn btn-primary">Boka</button>
            </div>
        </form>
    </div>
    {% endif %}
</div>
{% endblock %}
